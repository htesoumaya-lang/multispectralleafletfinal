<!DOCTYPE html>
<html>
<head>
    <title>Landsat Multispectral - 12 Tuiles</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            height: 100vh; 
            font-family: Arial, sans-serif;
            background: #1e3c72;
        }
        #map { 
            width: 100%; 
            height: 100vh; 
        }
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-left: 5px solid #2a5298;
        }
        .status {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .success { color: #27ae60; font-weight: bold; }
        .loading { color: #e67e22; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
    <div class="header">
        <h2 style="margin:0 0 5px 0; color: #2a5298;">üõ∞Ô∏è Landsat Multispectral</h2>
        <p style="margin:0; color: #666; font-size: 13px;">Italie du Nord - 12 tuiles RGB</p>
    </div>
    
    <div id="map"></div>
    
    <div class="status" id="status">
        <span class="loading">‚è≥ Chargement des tuiles...</span>
    </div>

    <script>
        // Initialisation de la carte
        const map = L.map('map', {
            center: [45.493, 12.321],
            zoom: 11,
            zoomControl: true
        });

        // Fond de carte OSM
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap',
            maxZoom: 18
        }).addTo(map);

        // === COORDONN√âES EXACTES ===
        const fullBounds = [
            [45.5859332, 12.1699431],  // Nord-Ouest
            [45.4005451, 12.4736074]   // Sud-Est
        ];

        // Calcul des dimensions des tuiles
        const latDiff = fullBounds[0][0] - fullBounds[1][0]; // 0.1853881
        const lngDiff = fullBounds[1][1] - fullBounds[0][1]; // 0.3036643
        
        const tileHeight = latDiff / 3;  // 0.061796033
        const tileWidth = lngDiff / 4;   // 0.075916075

        let loadedTiles = 0;
        let errorTiles = 0;
        const totalTiles = 12;
        const status = document.getElementById('status');

        // Afficher les 12 tuiles (1.png √† 12.png)
        for (let row = 0; row < 3; row++) {
            for (let col = 0; col < 4; col++) {
                // Calcul des coordonn√©es exactes
                const north = fullBounds[0][0] - (row * tileHeight);
                const south = fullBounds[0][0] - ((row + 1) * tileHeight);
                const west = fullBounds[0][1] + (col * tileWidth);
                const east = fullBounds[0][1] + ((col + 1) * tileWidth);
                
                const tileBounds = [[north, west], [south, east]];
                const tileNumber = (row * 4) + col + 1;
                
                // CHEMIN DIRECT - les images sont √† la racine
                const imageUrl = `${tileNumber}.png`;
                
                const tileLayer = L.imageOverlay(imageUrl, tileBounds, {
                    opacity: 0.9,
                    interactive: true
                }).addTo(map);
                
                // Popup d'information
                tileLayer.bindPopup(`
                    <div style="text-align: center; padding: 8px;">
                        <b>Tuile ${tileNumber}</b><br>
                        Position: Ligne ${row+1}, Colonne ${col+1}
                    </div>
                `);

                // Gestion du chargement
                tileLayer.on('load', function() {
                    loadedTiles++;
                    updateStatus();
                    console.log(`‚úÖ Tuile ${tileNumber} charg√©e: ${imageUrl}`);
                });
                
                tileLayer.on('error', function() {
                    errorTiles++;
                    updateStatus();
                    console.error(`‚ùå Erreur tuile ${tileNumber}: ${imageUrl}`);
                });
            }
        }

        function updateStatus() {
            if (loadedTiles === totalTiles) {
                status.innerHTML = `<span class="success">‚úÖ Toutes les tuiles charg√©es (${loadedTiles}/${totalTiles})</span>`;
            } else {
                status.innerHTML = `<span class="loading">‚è≥ Chargement: ${loadedTiles}/${totalTiles} tuiles`;
                if (errorTiles > 0) {
                    status.innerHTML += ` <span class="error">(${errorTiles} erreurs)</span>`;
                }
                status.innerHTML += `</span>`;
            }
        }

        // Centrer sur l'image
        map.fitBounds(fullBounds);

        // Cadre rouge autour de l'image
        L.rectangle(fullBounds, {
            color: '#e74c3c',
            weight: 3,
            fillOpacity: 0
        }).addTo(map).bindPopup('üõ∞Ô∏è <b>Emprise Landsat</b><br>Italie du Nord');

        // Contr√¥les
        L.control.scale({ imperial: false }).addTo(map);
        L.control.fullscreen().addTo(map);

        // V√©rification finale
        setTimeout(() => {
            if (loadedTiles === 0) {
                status.innerHTML = `<span class="error">‚ùå Aucune tuile charg√©e. V√©rifiez que 1.png √† 12.png sont bien upload√©s.</span>`;
            }
        }, 5000);

        // Debug
        console.log('=== CONFIGURATION ===');
        console.log('Images attendues: 1.png √† 12.png');
        console.log('Bounds:', fullBounds);
        console.log('Tile dimensions:', { tileWidth, tileHeight });

    </script>
</body>
</html>
