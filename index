<!DOCTYPE html>
<html>
<head>
    <title>Landsat Multispectral - Visualisation</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            height: 100vh; 
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        #map { 
            width: 100%; 
            height: 100vh; 
        }
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-left: 5px solid #2a5298;
            max-width: 300px;
        }
        .header h1 {
            margin: 0 0 5px 0;
            color: #2a5298;
            font-size: 18px;
        }
        .header p {
            margin: 0;
            color: #666;
            font-size: 12px;
        }
        .status {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .loading { color: #e67e22; }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõ∞Ô∏è Landsat Multispectral</h1>
        <p>Italie du Nord - 12 tuiles RGB<br>Dimensions: 791√ó655 pixels</p>
    </div>
    
    <div id="map"></div>
    
    <div class="status" id="status">
        <span class="loading">‚è≥ Chargement des tuiles...</span>
    </div>

    <script>
        // Initialisation de la carte centr√©e sur l'Italie
        const map = L.map('map', {
            center: [45.493, 12.321],
            zoom: 11,
            zoomControl: true
        });

        // Fond de carte OSM
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
            maxZoom: 19
        }).addTo(map);

        // === COORDONN√âES EXACTES DE VOTRE IMAGE LANDSAT ===
        const fullBounds = [
            [45.5859332, 12.1699431],  // Nord-Ouest
            [45.4005451, 12.4736074]   // Sud-Est
        ];

        // Calcul des dimensions de chaque tuile
        const latDiff = fullBounds[0][0] - fullBounds[1][0];
        const lngDiff = fullBounds[1][1] - fullBounds[0][1];
        
        const tileHeight = latDiff / 3;
        const tileWidth = lngDiff / 4;

        let loadedTiles = 0;
        let errorTiles = 0;
        const totalTiles = 12;
        const status = document.getElementById('status');

        // Afficher les 12 tuiles Landsat
        for (let row = 0; row < 3; row++) {
            for (let col = 0; col < 4; col++) {
                const north = fullBounds[0][0] - (row * tileHeight);
                const south = fullBounds[0][0] - ((row + 1) * tileHeight);
                const west = fullBounds[0][1] + (col * tileWidth);
                const east = fullBounds[0][1] + ((col + 1) * tileWidth);
                
                const tileBounds = [[north, west], [south, east]];
                const tileNumber = (row * 4) + col + 1;
                
                // CHEMIN CORRECT POUR GITHUB - V√âRIFIEZ LE NOM DU DOSSIER
                const imageUrl = `tiles/${tileNumber}.png`;
                
                const tileLayer = L.imageOverlay(imageUrl, tileBounds, {
                    opacity: 0.9,
                    interactive: true
                }).addTo(map);
                
                // Popup d'information pour chaque tuile
                tileLayer.bindPopup(`
                    <div style="text-align: center;">
                        <b>Tuile ${tileNumber}</b><br>
                        Position: ${row+1}√ó${col+1}<br>
                        Nord: ${north.toFixed(6)}<br>
                        Sud: ${south.toFixed(6)}<br>
                        Ouest: ${west.toFixed(6)}<br>
                        Est: ${east.toFixed(6)}
                    </div>
                `);

                // Gestion du chargement
                tileLayer.on('load', function() {
                    loadedTiles++;
                    updateStatus();
                    console.log(`‚úÖ Tuile ${tileNumber} charg√©e: ${imageUrl}`);
                });
                
                tileLayer.on('error', function() {
                    errorTiles++;
                    updateStatus();
                    console.error(`‚ùå Erreur tuile ${tileNumber}: ${imageUrl}`);
                    
                    // Afficher un placeholder en cas d'erreur
                    this.setOpacity(0.3);
                    this.getElement().style.backgroundColor = '#ffebee';
                });
            }
        }

        function updateStatus() {
            if (loadedTiles === totalTiles) {
                status.innerHTML = `<span class="success">‚úÖ Toutes les tuiles charg√©es (${loadedTiles}/${totalTiles})</span>`;
            } else {
                status.innerHTML = `<span class="loading">‚è≥ Chargement: ${loadedTiles}/${totalTiles} tuiles`;
                if (errorTiles > 0) {
                    status.innerHTML += ` <span class="error">(${errorTiles} erreurs)</span>`;
                }
                status.innerHTML += `</span>`;
            }
        }

        // Ajuster la vue sur l'image Landsat
        map.fitBounds(fullBounds);

        // Ajouter un cadre autour de l'image Landsat
        L.rectangle(fullBounds, {
            color: '#e74c3c',
            weight: 3,
            fillOpacity: 0,
            dashArray: '5, 5'
        }).addTo(map).bindPopup('üõ∞Ô∏è <b>Emprise Landsat Multispectral</b><br>Italie du Nord - Composition RGB');

        // Contr√¥les
        L.control.scale({ imperial: false, position: 'bottomright' }).addTo(map);
        
        // Contr√¥le plein √©cran
        L.control.fullscreen({
            position: 'topright',
            title: 'Plein √©cran',
            titleCancel: 'Quitter le plein √©cran'
        }).addTo(map);

        // V√©rification apr√®s 3 secondes
        setTimeout(() => {
            if (loadedTiles === 0) {
                status.innerHTML = `<span class="error">‚ùå Aucune tuile charg√©e. V√©rifiez le dossier 'tiles/' sur GitHub.</span>`;
            }
        }, 3000);

        // Debug info
        console.log('=== DEBUG INFORMATION ===');
        console.log('Bounds:', fullBounds);
        console.log('Tile dimensions:', { tileWidth, tileHeight });
        console.log('Expected image URLs: tiles/1.png to tiles/12.png');

    </script>
</body>
</html>
